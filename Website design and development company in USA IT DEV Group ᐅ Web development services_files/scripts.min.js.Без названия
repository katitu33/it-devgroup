(function () {
  window.history.scrollRestoration = 'manual';

  // progress-bar
  function progress() {
    let windowScrollTop = $(window).scrollTop();
    let docHeight = $(document).height();
    let windowHeight = $(window).height();
    let progress = (windowScrollTop / (docHeight - windowHeight)) * 100;
    let $bgColor = progress > 99 ? 'rgba(255, 255, 255, .9)' : 'rgba(255, 255, 255, .9)';
    $('.js-fill').height(progress + '%').css({ backgroundColor: $bgColor });
  }

  progress();

  let portfolioItem = $('.our-portfolio__item');

  portfolioItem.mouseover(function () {
    $(this).addClass('hover');
    $('.our-portfolio__item').css('opacity', '.7');
  });
  portfolioItem.mouseout(function () {
    $(this).removeClass('hover');
    $('.our-portfolio__item').css('opacity', '1');
  });

  $(document).on('scroll', progress);
  $(document).ready(function () {
    //phone mask init
    try {
      var maskList = $.masksSort($.masksLoad('/assets/v2.0/vendors/plugin/mask/phone-codes.json'), ['#'], /[0-9]|#/, 'mask');
    } catch (e) {
    }

    if (typeof maskList === 'undefined') {
      maskList = [
        {
          "mask": "+1(###)###-####",
          "cc": ["US", "CA"],
          "name_en": "USA and Canada",
          "desc_en": "",
          "name_ru": "США и Канада",
          "desc_ru": ""
        }
      ]
    }
    let maskOpts = {
      inputmask: {
        definitions: {
          '#': {
            validator: '[0-9]',
            cardinality: 1
          }
        },
        clearIncomplete: true,
        showMaskOnHover: false,
        autoUnmask: true
      },
      match: /[0-9]/,
      replace: '#',
      list: maskList,
      listKey: 'mask',
      onMaskChange: function (maskObj, determined) {
        if (determined) {
          let hint = maskObj.name_ru;
          if (maskObj.desc_ru && maskObj.desc_ru !== '') {
            hint += " (" + maskObj.desc_ru + ")";
          }
          $('.js_desc').html(hint);
        } else {
          $('.js_desc').html("Страна");
        }
      }
    };

    $('#js-phone-number').each(function () {
      $(this).inputmasks(maskOpts);
    });
    // menu
    $('.js-top-screen-btn').on('click', function () {
      $(this).toggleClass('on');
      $('body').toggleClass('fixed');
      $('.menu-modal').toggleClass('show');
    });
    $('.js-menu-modal-btn').on('click', function () {
      $('body').removeClass('fixed');
      $('.js-top-screen-btn').removeClass('on');
      $('.menu-modal').removeClass('show');
    });
    $(document).keyup(function (e) {
      if (e.key === 'Escape') {
        $('body').removeClass('fixed');
        $('.js-top-screen-btn').removeClass('on');
        $('.menu-modal').removeClass('show');
      }
    });
    // scroll smooth
    $('a.ancLinks').click(function () {
      let elementClick = $(this).attr('href');
      let destination = $(elementClick).offset().top;
      $('html,body').animate({ scrollTop: destination }, 700);
      return false;
    });
    // form
    let input = $('.form-input');
    input.focus(function () {
      $(this).parents('.form-group').addClass('focused');
    });
    input.focus(function () {
      $(this).parents('.form-group').addClass('focused');
    });
    input.blur(function () {
      let inputValue = $(this).val();
      if (inputValue === '') {
        $(this).removeClass('filled');
        $(this).parents('.form-group').removeClass('focused');
      } else {
        $(this).addClass('filled');
      }
    });
    // button to top
    let toTop = $('#js-scrollUp');
    let scrollBackToTop = $('#js-backTop');
    if (toTop.length) {
      let scrollTrigger = 1200,
          backToTop = function () {
            let scrollTop = $(window).scrollTop();
            if (scrollTop > scrollTrigger) {
              toTop.addClass('show');
            } else {
              toTop.removeClass('show');
            }
          };
      backToTop();
      $(window).on('scroll', function () {
        backToTop();
      });
      toTop.on('click', function (e) {
        e.preventDefault();
        $('html, body').animate({
          scrollTop: 0
        }, 400);
      });
    }
    scrollBackToTop.on('click', function () {
      $('html, body').animate({
        scrollTop: 0
      }, 600);
      $('.formOrder__inner.ajax_form').find('.formOrder__body').removeClass('active').eq(0).addClass('active');
    });
    // form navigation
    let formOrderSteps = function (selector, curSelector) {
      if (selector.length) {
        curSelector.removeClass('active');
        selector.addClass('active');
      }
    };
    $('.formOrder__footer .formOrder__btn').on('click', function (e) {
      e.preventDefault();
      let $this = $(this),
          $modalContent = $(this).closest('.formOrder'),
          isNext = $this.is('.next'),
          isPrev = $this.is('.prev'),
          $activeBody = $('.formOrder__body.active'),
          $nextBody = $activeBody.next('.formOrder__body'),
          $prevBody = $activeBody.prev('.formOrder__body'),
          $counterSteps = $modalContent.find('.formOrder__counter span'),
          $progressBar = $('.progress-bar'),
          dataStep = parseInt($progressBar.attr('data-step')),
          $formOrder = $('.formOrder__body'),
          $email = $formOrder.find('#email'),
          $company = $formOrder.find('#company'),
          flag = true;

      function nextStep() {
        formOrderSteps($nextBody, $activeBody);
        dataStep += 1;
        $counterSteps.html(dataStep);
        if (dataStep <= 6) $progressBar.add($modalContent).attr('data-step', dataStep);
        $('.formOrder .error').html('');
      }

      function checkEmail() {
        let patternEmail = /^[+a-zA-z0-9._-]+@[a-zA-z0-9-]+\.[a-zA-z]/i;
        if (patternEmail.test($email.val())) {
          $('.error.emailError').html('');
          return true;
        } else {
          $('.error.emailError').html('Enter the valid email address');
          return false;
        }
      }

      if (isNext) {
        if (dataStep === 0) {
          formOrderSteps($nextBody, $activeBody);
          dataStep += 1;
          $counterSteps.html(dataStep);
          if (dataStep <= 6) {
            $progressBar.add($modalContent).attr('data-step', dataStep);
          }
        } else {
          if ($company.val() === '' || $company.val() === undefined) {
            flag = false;
            $('.nameError').html('The field is required');

          } else {
            $('.nameError').html('');
          }
          if ($email.val() === '' || $email.val() === undefined) {
            flag = false;
            $('.emailError').html('The field is required');
          } else {
            $('.emailError').html('');
            if (!checkEmail()) flag = false;
          }
          if (flag && dataStep > 4) {
            $('.formOrder__inner.ajax_form').submit();
            $counterSteps.html('5');

            return true;
          }
          if (flag) {
            nextStep();
          }
        }
      }
      if (isPrev) {
        formOrderSteps($prevBody, $activeBody);
        dataStep -= 1;
        $counterSteps.html(dataStep);
        if (dataStep >= 1) {
          $progressBar.add($modalContent).attr('data-step', dataStep);
        }
      }
    });
  });
  // pin
  $(window).on('load', function () {
    $('#pin').pin({
      containerSelector: '.container-flex',
      padding: { top: 120, bottom: 20 },
      minWidth: 701
    });
  });
  $('.services-menu').on('click', function () {
    $('.menu-modal__sub-cell').addClass('open');
  });
  $('.js-formOrder-btn').on('click', function () {
    $('.menu-modal__sub-cell').removeClass('open');
  });

  $.each($('textarea[data-autoresize]'), function () {
    let offset = this.offsetHeight - this.clientHeight;
    let resizeTextarea = function (el) {
      $(el).css('height', 'auto').css('height', el.scrollHeight + offset);
    };
    $(this).on('keyup input', function () {
      resizeTextarea(this);
    }).removeAttr('data-autoresize');
  });

  $('#task').bind('input propertychange', function () {
    const areaHeight = $(this).height();
    const textareaWrapper = $('.box-textarea');
    (areaHeight >= 80) ? textareaWrapper.addClass('full-height') : textareaWrapper.removeClass('full-height');
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJzY3JpcHRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gIHdpbmRvdy5oaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gJ21hbnVhbCc7XG5cbiAgLy8gcHJvZ3Jlc3MtYmFyXG4gIGZ1bmN0aW9uIHByb2dyZXNzKCkge1xuICAgIGxldCB3aW5kb3dTY3JvbGxUb3AgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XG4gICAgbGV0IGRvY0hlaWdodCA9ICQoZG9jdW1lbnQpLmhlaWdodCgpO1xuICAgIGxldCB3aW5kb3dIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7XG4gICAgbGV0IHByb2dyZXNzID0gKHdpbmRvd1Njcm9sbFRvcCAvIChkb2NIZWlnaHQgLSB3aW5kb3dIZWlnaHQpKSAqIDEwMDtcbiAgICBsZXQgJGJnQ29sb3IgPSBwcm9ncmVzcyA+IDk5ID8gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgLjkpJyA6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIC45KSc7XG4gICAgJCgnLmpzLWZpbGwnKS5oZWlnaHQocHJvZ3Jlc3MgKyAnJScpLmNzcyh7IGJhY2tncm91bmRDb2xvcjogJGJnQ29sb3IgfSk7XG4gIH1cblxuICBwcm9ncmVzcygpO1xuXG4gIGxldCBwb3J0Zm9saW9JdGVtID0gJCgnLm91ci1wb3J0Zm9saW9fX2l0ZW0nKTtcblxuICBwb3J0Zm9saW9JdGVtLm1vdXNlb3ZlcihmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS5hZGRDbGFzcygnaG92ZXInKTtcbiAgICAkKCcub3VyLXBvcnRmb2xpb19faXRlbScpLmNzcygnb3BhY2l0eScsICcuNycpO1xuICB9KTtcbiAgcG9ydGZvbGlvSXRlbS5tb3VzZW91dChmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaG92ZXInKTtcbiAgICAkKCcub3VyLXBvcnRmb2xpb19faXRlbScpLmNzcygnb3BhY2l0eScsICcxJyk7XG4gIH0pO1xuXG4gICQoZG9jdW1lbnQpLm9uKCdzY3JvbGwnLCBwcm9ncmVzcyk7XG4gICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAvL3Bob25lIG1hc2sgaW5pdFxuICAgIHRyeSB7XG4gICAgICB2YXIgbWFza0xpc3QgPSAkLm1hc2tzU29ydCgkLm1hc2tzTG9hZCgnL2Fzc2V0cy92Mi4wL3ZlbmRvcnMvcGx1Z2luL21hc2svcGhvbmUtY29kZXMuanNvbicpLCBbJyMnXSwgL1swLTldfCMvLCAnbWFzaycpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIG1hc2tMaXN0ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgbWFza0xpc3QgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBcIm1hc2tcIjogXCIrMSgjIyMpIyMjLSMjIyNcIixcbiAgICAgICAgICBcImNjXCI6IFtcIlVTXCIsIFwiQ0FcIl0sXG4gICAgICAgICAgXCJuYW1lX2VuXCI6IFwiVVNBIGFuZCBDYW5hZGFcIixcbiAgICAgICAgICBcImRlc2NfZW5cIjogXCJcIixcbiAgICAgICAgICBcIm5hbWVfcnVcIjogXCLQodCo0JAg0Lgg0JrQsNC90LDQtNCwXCIsXG4gICAgICAgICAgXCJkZXNjX3J1XCI6IFwiXCJcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH1cbiAgICBsZXQgbWFza09wdHMgPSB7XG4gICAgICBpbnB1dG1hc2s6IHtcbiAgICAgICAgZGVmaW5pdGlvbnM6IHtcbiAgICAgICAgICAnIyc6IHtcbiAgICAgICAgICAgIHZhbGlkYXRvcjogJ1swLTldJyxcbiAgICAgICAgICAgIGNhcmRpbmFsaXR5OiAxXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjbGVhckluY29tcGxldGU6IHRydWUsXG4gICAgICAgIHNob3dNYXNrT25Ib3ZlcjogZmFsc2UsXG4gICAgICAgIGF1dG9Vbm1hc2s6IHRydWVcbiAgICAgIH0sXG4gICAgICBtYXRjaDogL1swLTldLyxcbiAgICAgIHJlcGxhY2U6ICcjJyxcbiAgICAgIGxpc3Q6IG1hc2tMaXN0LFxuICAgICAgbGlzdEtleTogJ21hc2snLFxuICAgICAgb25NYXNrQ2hhbmdlOiBmdW5jdGlvbiAobWFza09iaiwgZGV0ZXJtaW5lZCkge1xuICAgICAgICBpZiAoZGV0ZXJtaW5lZCkge1xuICAgICAgICAgIGxldCBoaW50ID0gbWFza09iai5uYW1lX3J1O1xuICAgICAgICAgIGlmIChtYXNrT2JqLmRlc2NfcnUgJiYgbWFza09iai5kZXNjX3J1ICE9PSAnJykge1xuICAgICAgICAgICAgaGludCArPSBcIiAoXCIgKyBtYXNrT2JqLmRlc2NfcnUgKyBcIilcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgJCgnLmpzX2Rlc2MnKS5odG1sKGhpbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJy5qc19kZXNjJykuaHRtbChcItCh0YLRgNCw0L3QsFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICAkKCcjanMtcGhvbmUtbnVtYmVyJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAkKHRoaXMpLmlucHV0bWFza3MobWFza09wdHMpO1xuICAgIH0pO1xuICAgIC8vIG1lbnVcbiAgICAkKCcuanMtdG9wLXNjcmVlbi1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvbicpO1xuICAgICAgJCgnYm9keScpLnRvZ2dsZUNsYXNzKCdmaXhlZCcpO1xuICAgICAgJCgnLm1lbnUtbW9kYWwnKS50b2dnbGVDbGFzcygnc2hvdycpO1xuICAgIH0pO1xuICAgICQoJy5qcy1tZW51LW1vZGFsLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcbiAgICAgICQoJy5qcy10b3Atc2NyZWVuLWJ0bicpLnJlbW92ZUNsYXNzKCdvbicpO1xuICAgICAgJCgnLm1lbnUtbW9kYWwnKS5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgIH0pO1xuICAgICQoZG9jdW1lbnQpLmtleXVwKGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgJCgnLmpzLXRvcC1zY3JlZW4tYnRuJykucmVtb3ZlQ2xhc3MoJ29uJyk7XG4gICAgICAgICQoJy5tZW51LW1vZGFsJykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBzY3JvbGwgc21vb3RoXG4gICAgJCgnYS5hbmNMaW5rcycpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBlbGVtZW50Q2xpY2sgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICAgIGxldCBkZXN0aW5hdGlvbiA9ICQoZWxlbWVudENsaWNrKS5vZmZzZXQoKS50b3A7XG4gICAgICAkKCdodG1sLGJvZHknKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiBkZXN0aW5hdGlvbiB9LCA3MDApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICAgIC8vIGZvcm1cbiAgICBsZXQgaW5wdXQgPSAkKCcuZm9ybS1pbnB1dCcpO1xuICAgIGlucHV0LmZvY3VzKGZ1bmN0aW9uICgpIHtcbiAgICAgICQodGhpcykucGFyZW50cygnLmZvcm0tZ3JvdXAnKS5hZGRDbGFzcygnZm9jdXNlZCcpO1xuICAgIH0pO1xuICAgIGlucHV0LmZvY3VzKGZ1bmN0aW9uICgpIHtcbiAgICAgICQodGhpcykucGFyZW50cygnLmZvcm0tZ3JvdXAnKS5hZGRDbGFzcygnZm9jdXNlZCcpO1xuICAgIH0pO1xuICAgIGlucHV0LmJsdXIoZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGlucHV0VmFsdWUgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgaWYgKGlucHV0VmFsdWUgPT09ICcnKSB7XG4gICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2ZpbGxlZCcpO1xuICAgICAgICAkKHRoaXMpLnBhcmVudHMoJy5mb3JtLWdyb3VwJykucmVtb3ZlQ2xhc3MoJ2ZvY3VzZWQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2ZpbGxlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGJ1dHRvbiB0byB0b3BcbiAgICBsZXQgdG9Ub3AgPSAkKCcjanMtc2Nyb2xsVXAnKTtcbiAgICBsZXQgc2Nyb2xsQmFja1RvVG9wID0gJCgnI2pzLWJhY2tUb3AnKTtcbiAgICBpZiAodG9Ub3AubGVuZ3RoKSB7XG4gICAgICBsZXQgc2Nyb2xsVHJpZ2dlciA9IDEyMDAsXG4gICAgICAgICAgYmFja1RvVG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IHNjcm9sbFRvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAgIGlmIChzY3JvbGxUb3AgPiBzY3JvbGxUcmlnZ2VyKSB7XG4gICAgICAgICAgICAgIHRvVG9wLmFkZENsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0b1RvcC5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICBiYWNrVG9Ub3AoKTtcbiAgICAgICQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBiYWNrVG9Ub3AoKTtcbiAgICAgIH0pO1xuICAgICAgdG9Ub3Aub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgc2Nyb2xsVG9wOiAwXG4gICAgICAgIH0sIDQwMCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgc2Nyb2xsQmFja1RvVG9wLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wOiAwXG4gICAgICB9LCA2MDApO1xuICAgICAgJCgnLmZvcm1PcmRlcl9faW5uZXIuYWpheF9mb3JtJykuZmluZCgnLmZvcm1PcmRlcl9fYm9keScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKS5lcSgwKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgfSk7XG4gICAgLy8gZm9ybSBuYXZpZ2F0aW9uXG4gICAgbGV0IGZvcm1PcmRlclN0ZXBzID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBjdXJTZWxlY3Rvcikge1xuICAgICAgaWYgKHNlbGVjdG9yLmxlbmd0aCkge1xuICAgICAgICBjdXJTZWxlY3Rvci5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIHNlbGVjdG9yLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgIH1cbiAgICB9O1xuICAgICQoJy5mb3JtT3JkZXJfX2Zvb3RlciAuZm9ybU9yZGVyX19idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgbGV0ICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAkbW9kYWxDb250ZW50ID0gJCh0aGlzKS5jbG9zZXN0KCcuZm9ybU9yZGVyJyksXG4gICAgICAgICAgaXNOZXh0ID0gJHRoaXMuaXMoJy5uZXh0JyksXG4gICAgICAgICAgaXNQcmV2ID0gJHRoaXMuaXMoJy5wcmV2JyksXG4gICAgICAgICAgJGFjdGl2ZUJvZHkgPSAkKCcuZm9ybU9yZGVyX19ib2R5LmFjdGl2ZScpLFxuICAgICAgICAgICRuZXh0Qm9keSA9ICRhY3RpdmVCb2R5Lm5leHQoJy5mb3JtT3JkZXJfX2JvZHknKSxcbiAgICAgICAgICAkcHJldkJvZHkgPSAkYWN0aXZlQm9keS5wcmV2KCcuZm9ybU9yZGVyX19ib2R5JyksXG4gICAgICAgICAgJGNvdW50ZXJTdGVwcyA9ICRtb2RhbENvbnRlbnQuZmluZCgnLmZvcm1PcmRlcl9fY291bnRlciBzcGFuJyksXG4gICAgICAgICAgJHByb2dyZXNzQmFyID0gJCgnLnByb2dyZXNzLWJhcicpLFxuICAgICAgICAgIGRhdGFTdGVwID0gcGFyc2VJbnQoJHByb2dyZXNzQmFyLmF0dHIoJ2RhdGEtc3RlcCcpKSxcbiAgICAgICAgICAkZm9ybU9yZGVyID0gJCgnLmZvcm1PcmRlcl9fYm9keScpLFxuICAgICAgICAgICRlbWFpbCA9ICRmb3JtT3JkZXIuZmluZCgnI2VtYWlsJyksXG4gICAgICAgICAgJGNvbXBhbnkgPSAkZm9ybU9yZGVyLmZpbmQoJyNjb21wYW55JyksXG4gICAgICAgICAgZmxhZyA9IHRydWU7XG5cbiAgICAgIGZ1bmN0aW9uIG5leHRTdGVwKCkge1xuICAgICAgICBmb3JtT3JkZXJTdGVwcygkbmV4dEJvZHksICRhY3RpdmVCb2R5KTtcbiAgICAgICAgZGF0YVN0ZXAgKz0gMTtcbiAgICAgICAgJGNvdW50ZXJTdGVwcy5odG1sKGRhdGFTdGVwKTtcbiAgICAgICAgaWYgKGRhdGFTdGVwIDw9IDYpICRwcm9ncmVzc0Jhci5hZGQoJG1vZGFsQ29udGVudCkuYXR0cignZGF0YS1zdGVwJywgZGF0YVN0ZXApO1xuICAgICAgICAkKCcuZm9ybU9yZGVyIC5lcnJvcicpLmh0bWwoJycpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjaGVja0VtYWlsKCkge1xuICAgICAgICBsZXQgcGF0dGVybkVtYWlsID0gL15bK2EtekEtejAtOS5fLV0rQFthLXpBLXowLTktXStcXC5bYS16QS16XS9pO1xuICAgICAgICBpZiAocGF0dGVybkVtYWlsLnRlc3QoJGVtYWlsLnZhbCgpKSkge1xuICAgICAgICAgICQoJy5lcnJvci5lbWFpbEVycm9yJykuaHRtbCgnJyk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCgnLmVycm9yLmVtYWlsRXJyb3InKS5odG1sKCdFbnRlciB0aGUgdmFsaWQgZW1haWwgYWRkcmVzcycpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoaXNOZXh0KSB7XG4gICAgICAgIGlmIChkYXRhU3RlcCA9PT0gMCkge1xuICAgICAgICAgIGZvcm1PcmRlclN0ZXBzKCRuZXh0Qm9keSwgJGFjdGl2ZUJvZHkpO1xuICAgICAgICAgIGRhdGFTdGVwICs9IDE7XG4gICAgICAgICAgJGNvdW50ZXJTdGVwcy5odG1sKGRhdGFTdGVwKTtcbiAgICAgICAgICBpZiAoZGF0YVN0ZXAgPD0gNikge1xuICAgICAgICAgICAgJHByb2dyZXNzQmFyLmFkZCgkbW9kYWxDb250ZW50KS5hdHRyKCdkYXRhLXN0ZXAnLCBkYXRhU3RlcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICgkY29tcGFueS52YWwoKSA9PT0gJycgfHwgJGNvbXBhbnkudmFsKCkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZmxhZyA9IGZhbHNlO1xuICAgICAgICAgICAgJCgnLm5hbWVFcnJvcicpLmh0bWwoJ1RoZSBmaWVsZCBpcyByZXF1aXJlZCcpO1xuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJy5uYW1lRXJyb3InKS5odG1sKCcnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCRlbWFpbC52YWwoKSA9PT0gJycgfHwgJGVtYWlsLnZhbCgpID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcbiAgICAgICAgICAgICQoJy5lbWFpbEVycm9yJykuaHRtbCgnVGhlIGZpZWxkIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJy5lbWFpbEVycm9yJykuaHRtbCgnJyk7XG4gICAgICAgICAgICBpZiAoIWNoZWNrRW1haWwoKSkgZmxhZyA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmxhZyAmJiBkYXRhU3RlcCA+IDQpIHtcbiAgICAgICAgICAgICQoJy5mb3JtT3JkZXJfX2lubmVyLmFqYXhfZm9ybScpLnN1Ym1pdCgpO1xuICAgICAgICAgICAgJGNvdW50ZXJTdGVwcy5odG1sKCc1Jyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmxhZykge1xuICAgICAgICAgICAgbmV4dFN0ZXAoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpc1ByZXYpIHtcbiAgICAgICAgZm9ybU9yZGVyU3RlcHMoJHByZXZCb2R5LCAkYWN0aXZlQm9keSk7XG4gICAgICAgIGRhdGFTdGVwIC09IDE7XG4gICAgICAgICRjb3VudGVyU3RlcHMuaHRtbChkYXRhU3RlcCk7XG4gICAgICAgIGlmIChkYXRhU3RlcCA+PSAxKSB7XG4gICAgICAgICAgJHByb2dyZXNzQmFyLmFkZCgkbW9kYWxDb250ZW50KS5hdHRyKCdkYXRhLXN0ZXAnLCBkYXRhU3RlcCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gIC8vIHBpblxuICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCgnI3BpbicpLnBpbih7XG4gICAgICBjb250YWluZXJTZWxlY3RvcjogJy5jb250YWluZXItZmxleCcsXG4gICAgICBwYWRkaW5nOiB7IHRvcDogMTIwLCBib3R0b206IDIwIH0sXG4gICAgICBtaW5XaWR0aDogNzAxXG4gICAgfSk7XG4gIH0pO1xuICAkKCcuc2VydmljZXMtbWVudScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAkKCcubWVudS1tb2RhbF9fc3ViLWNlbGwnKS5hZGRDbGFzcygnb3BlbicpO1xuICB9KTtcbiAgJCgnLmpzLWZvcm1PcmRlci1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgJCgnLm1lbnUtbW9kYWxfX3N1Yi1jZWxsJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgfSk7XG5cbiAgJC5lYWNoKCQoJ3RleHRhcmVhW2RhdGEtYXV0b3Jlc2l6ZV0nKSwgZnVuY3Rpb24gKCkge1xuICAgIGxldCBvZmZzZXQgPSB0aGlzLm9mZnNldEhlaWdodCAtIHRoaXMuY2xpZW50SGVpZ2h0O1xuICAgIGxldCByZXNpemVUZXh0YXJlYSA9IGZ1bmN0aW9uIChlbCkge1xuICAgICAgJChlbCkuY3NzKCdoZWlnaHQnLCAnYXV0bycpLmNzcygnaGVpZ2h0JywgZWwuc2Nyb2xsSGVpZ2h0ICsgb2Zmc2V0KTtcbiAgICB9O1xuICAgICQodGhpcykub24oJ2tleXVwIGlucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgcmVzaXplVGV4dGFyZWEodGhpcyk7XG4gICAgfSkucmVtb3ZlQXR0cignZGF0YS1hdXRvcmVzaXplJyk7XG4gIH0pO1xuXG4gICQoJyN0YXNrJykuYmluZCgnaW5wdXQgcHJvcGVydHljaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgYXJlYUhlaWdodCA9ICQodGhpcykuaGVpZ2h0KCk7XG4gICAgY29uc3QgdGV4dGFyZWFXcmFwcGVyID0gJCgnLmJveC10ZXh0YXJlYScpO1xuICAgIChhcmVhSGVpZ2h0ID49IDgwKSA/IHRleHRhcmVhV3JhcHBlci5hZGRDbGFzcygnZnVsbC1oZWlnaHQnKSA6IHRleHRhcmVhV3JhcHBlci5yZW1vdmVDbGFzcygnZnVsbC1oZWlnaHQnKTtcbiAgfSk7XG59KSgpO1xuIl0sImZpbGUiOiJzY3JpcHRzLmpzIn0=
